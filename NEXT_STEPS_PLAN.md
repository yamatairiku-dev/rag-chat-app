# 次のステッププラン

**作成日**: 2025年12月5日  
**現在の状況**: テストカバレッジ78.35%、エラーハンドリング日本語化完了

---

## 📊 現在の状況

### ✅ 完了した項目

- ✅ テストカバレッジの改善（78.35%達成）
- ✅ `settings.tsx`のテスト追加（100%カバレッジ）
- ✅ `chat.tsx`のコンポーネントテスト追加
- ✅ エラーハンドリングの日本語化
- ✅ パフォーマンス測定（ビルドサイズ確認）
- ✅ Dify API接続テストスクリプトの作成
- ✅ CI/CDパイプラインの設定（`.github/workflows/test.yml`）

### 📈 現在のメトリクス

- **テスト**: 324テスト成功（100%）
- **テストカバレッジ**: 78.35%（目標80%に近い）
- **ビルド**: 正常に完了
- **エラーハンドリング**: 日本語化完了

---

## 🎯 次のステッププラン（優先順位順）

### 優先度: 高 🔴

#### 1. テストカバレッジを80%以上に向上（1-2時間）

**現状**: 78.35%（目標: 80%以上）

**作業内容**:
- `chat.tsx`のストリーミング処理のテスト追加
  - 現在のカバレッジ: 37.72%
  - 未カバー箇所: 223-452行目、457-471行目
  - 主に`startStreaming`関数と`handleSubmit`関数

**期待される成果**:
- テストカバレッジが80%以上になる
- `chat.tsx`のカバレッジが50%以上になる

**実装方法**:
```typescript
// tests/unit/routes/chat-streaming.test.tsx を作成
// - startStreaming関数のテスト
// - ストリーミングイベントの処理テスト
// - エラーハンドリングのテスト
```

---

#### 2. CI/CDパイプラインの動作確認と改善（1時間）

**現状**: `.github/workflows/test.yml`は設定済み

**作業内容**:
- [ ] E2Eテストの追加（現在はユニットテストのみ）
- [ ] カバレッジレポートの自動アップロード確認
- [ ] プルリクエスト時の自動チェック確認

**期待される成果**:
- プルリクエストごとに自動テストが実行される
- カバレッジレポートが自動生成される

---

#### 3. パフォーマンス最適化の実施（2-3時間）

**現状**: ビルドサイズは確認済み（クライアント: 1.5MB）

**作業内容**:
- [ ] Code Splittingの確認と改善
- [ ] バンドルサイズの分析（webpack-bundle-analyzerなど）
- [ ] 不要な依存関係の削除
- [ ] 画像・アセットの最適化

**確認項目**:
```bash
# バンドルサイズの詳細分析
npm run build
# build/client/assets のサイズを確認
```

**期待される成果**:
- バンドルサイズが最適化される
- 初回ロード時間が短縮される

---

### 優先度: 中 🟡

#### 4. アクセシビリティの改善（3-4時間）

**作業内容**:
- [ ] ARIA属性の追加
- [ ] キーボード操作の改善
- [ ] スクリーンリーダー対応
- [ ] コントラスト比の確認
- [ ] フォーカス表示の改善

**確認ツール**:
- Lighthouse（アクセシビリティスコア）
- axe DevTools
- WAVE

**期待される成果**:
- アクセシビリティスコアが向上する
- より多くのユーザーが利用できる

---

#### 5. ドキュメントの整備（2-3時間）

**作業内容**:
- [ ] APIドキュメントの整備
- [ ] コンポーネントドキュメントの追加
- [ ] トラブルシューティングガイドの拡充
- [ ] 開発者向けガイドの更新

**期待される成果**:
- 新規開発者のオンボーディングが容易になる
- 開発効率が向上する

---

#### 6. エラーハンドリングのさらなる強化（2時間）

**作業内容**:
- [ ] エラー回復機能の追加（リトライボタンなど）
- [ ] ネットワークエラー時の自動リトライ
- [ ] ユーザー向けエラーメッセージの改善
- [ ] エラーログの詳細化

**期待される成果**:
- ユーザーがエラーから回復しやすくなる
- デバッグが容易になる

---

### 優先度: 低 🟢

#### 7. 機能拡張の検討（オプション）

**検討項目**:
- [ ] メッセージ検索機能
- [ ] 会話のエクスポート機能（PDF、テキスト）
- [ ] ダークモード対応
- [ ] 多言語対応（i18n）
- [ ] 通知機能（新着メッセージなど）
- [ ] 会話の共有機能

---

#### 8. 監視・ロギングの強化（オプション）

**作業内容**:
- [ ] Azure Application Insightsの統合
- [ ] エラートラッキングの強化
- [ ] パフォーマンスメトリクスの収集
- [ ] アラート設定

---

#### 9. Redisセッションストレージの実装（将来）

**作業内容**:
- [ ] Redis接続の実装
- [ ] `app/lib/session/redis-storage.ts` の実装
- [ ] セッションストレージの切り替え機能
- [ ] パフォーマンステスト

**理由**: 本番環境でのスケールアウトに対応するため

---

## 📋 推奨される実行順序

### 今週中（優先度: 高）

1. **テストカバレッジを80%以上に向上**
   - `chat.tsx`のストリーミング処理テスト追加
   - 目標: 全体カバレッジ80%以上

2. **CI/CDパイプラインの動作確認**
   - E2Eテストの追加
   - カバレッジレポートの確認

3. **パフォーマンス最適化**
   - バンドルサイズの分析
   - Code Splittingの確認

### 来週（優先度: 中）

4. **アクセシビリティの改善**
   - ARIA属性の追加
   - キーボード操作の改善

5. **ドキュメントの整備**
   - APIドキュメントの追加
   - コンポーネントドキュメントの追加

---

## 🎯 短期目標（1-2週間）

- ✅ テストカバレッジ: 80%以上
- ✅ CI/CDパイプライン: 完全動作
- ✅ パフォーマンス: 最適化完了
- ✅ アクセシビリティ: 改善完了

---

## 📊 期待される成果

### 短期（1-2週間）

- テストカバレッジが80%以上になる
- CI/CDパイプラインが完全に動作する
- パフォーマンスが最適化される
- アクセシビリティが改善される

### 中期（1ヶ月）

- ドキュメントが整備される
- エラーハンドリングがさらに強化される
- 監視・ロギングが強化される

### 長期（3ヶ月以降）

- 新機能の追加
- Redisセッションストレージの実装
- ユーザーフィードバックの反映

---

## 💡 技術的メモ

### 現在の技術スタック

- **フロントエンド**: React 19, React Router 7, Tailwind CSS 4
- **バックエンド**: Node.js 24, React Router SSR
- **認証**: Microsoft Entra ID (OAuth 2.0)
- **API**: Dify API (ストリーミング対応)
- **テスト**: Vitest, Playwright
- **ロギング**: Winston
- **CI/CD**: GitHub Actions

### 次のマイルストーン

1. **品質保証の最終調整**（今週）
   - テストカバレッジ80%以上
   - CI/CDパイプラインの完全動作

2. **パフォーマンス最適化**（来週）
   - バンドルサイズの最適化
   - ロード時間の短縮

3. **ユーザー体験の向上**（2週間後）
   - アクセシビリティの向上
   - エラーハンドリングの強化

---

## 🚀 今すぐ実行できるアクション

### 1. テストカバレッジの向上

```bash
# カバレッジレポートの確認
npm run test -- --coverage
# coverage/index.html を開いて詳細を確認

# chat.tsxの未カバー箇所を確認
# 223-452行目、457-471行目
```

### 2. CI/CDパイプラインの確認

```bash
# GitHub Actionsの動作確認
# .github/workflows/test.yml を確認
# プルリクエストを作成して動作確認
```

### 3. パフォーマンス分析

```bash
# ビルドサイズの確認
npm run build
du -sh build/client/* build/server/*

# バンドル分析ツールの使用を検討
# npm install --save-dev webpack-bundle-analyzer
```

---

**最終更新**: 2025年12月5日



