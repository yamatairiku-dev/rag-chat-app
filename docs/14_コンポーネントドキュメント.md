# コンポーネントドキュメント

このドキュメントでは、アプリケーションで使用される主要なReactコンポーネントの仕様と使用方法を説明します。

---

## 目次

1. [ChatMessage](#chatmessage)
2. [Header](#header)
3. [UIコンポーネント](#uiコンポーネント)
   - [Button](#button)
   - [Input](#input)
   - [Avatar](#avatar)
   - [Card](#card)

---

## ChatMessage

チャットメッセージを表示するコンポーネント。Markdown形式のテキストをレンダリングし、コードブロックのシンタックスハイライトに対応しています。

### 場所

`app/components/chat/ChatMessage.tsx`

### Props

```typescript
interface ChatMessageProps {
  message: Message;
}
```

#### Message型

```typescript
interface Message {
  id: string;
  conversationId: string;
  role: "user" | "assistant";
  content: string;
  timestamp: number;
  isComplete: boolean;
  isStreaming?: boolean;
  error?: string;
}
```

### 機能

- **Markdownレンダリング**: `react-markdown`を使用してMarkdown形式のテキストをレンダリング
- **シンタックスハイライト**: コードブロックを`react-syntax-highlighter`でハイライト表示
- **動的ロード**: コードブロックがある場合のみシンタックスハイライトのスタイルを動的にロード（パフォーマンス最適化）
- **ストリーミング表示**: ストリーミング中のメッセージにインジケーター（▋）を表示
- **エラー表示**: エラーメッセージがある場合に表示
- **アクセシビリティ**: ARIA属性を適切に設定

### 使用例

```typescript
import { ChatMessage } from "~/components/chat/ChatMessage";
import type { Message } from "~/types/chat";

const message: Message = {
  id: "msg-1",
  conversationId: "conv-1",
  role: "assistant",
  content: "# タイトル\n\nこれは**太字**のテキストです。\n\n```typescript\nconst code = "example";\n```",
  timestamp: Date.now(),
  isComplete: true,
  isStreaming: false,
};

function ChatView() {
  return (
    <div>
      <ChatMessage message={message} />
    </div>
  );
}
```

### スタイリング

- **ユーザーメッセージ**: 右寄せ、青背景（`bg-blue-600`）
- **アシスタントメッセージ**: 左寄せ、グレー背景（`bg-gray-100`）
- **ストリーミングインジケーター**: アニメーション付きの「▋」文字

### パフォーマンス最適化

- コードブロックが含まれている場合のみシンタックスハイライトのスタイルをロード
- 動的インポートにより初期バンドルサイズを削減

---

## Header

アプリケーションのヘッダーコンポーネント。ユーザー情報の表示とログアウト機能を提供します。

### 場所

`app/components/layout/Header.tsx`

### Props

```typescript
interface HeaderProps {
  user: {
    displayName: string;
    userEmail: string;
    departmentCode: string;
    departmentName?: string;
  };
  errorMessage?: string | null;
}
```

### 機能

- **ユーザー情報表示**: 表示名、メールアドレス、所属部署を表示
- **アバター表示**: ユーザーのイニシャルを表示
- **ログアウト機能**: ログアウトボタンを提供
- **エラーメッセージ表示**: フォームエラーなどのメッセージを表示
- **アクセシビリティ**: ARIA属性を適切に設定

### 使用例

```typescript
import { Header } from "~/components/layout/Header";

function ChatPage() {
  const user = {
    displayName: "田中太郎",
    userEmail: "tanaka@company.com",
    departmentCode: "001",
    departmentName: "営業部",
  };

  return (
    <div>
      <Header user={user} errorMessage={null} />
      {/* その他のコンテンツ */}
    </div>
  );
}
```

### スタイリング

- **背景**: 白背景（`bg-white`）
- **ボーダー**: 下部にボーダー（`border-b`）
- **レイアウト**: フレックスボックスで左右に配置

### アクセシビリティ

- `role="banner"` - ヘッダーの役割を明確化
- `aria-label` - ユーザー情報の説明
- `role="alert"` - エラーメッセージの役割
- `aria-live="polite"` - エラーメッセージの動的更新

---

## UIコンポーネント

shadcn/uiベースの再利用可能なUIコンポーネント群。

### Button

汎用的なボタンコンポーネント。

#### 場所

`app/components/ui/button.tsx`

#### Props

```typescript
interface ButtonProps extends React.ComponentProps<"button"> {
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link";
  size?: "default" | "sm" | "lg" | "icon" | "icon-sm" | "icon-lg";
  asChild?: boolean;
}
```

#### 使用例

```typescript
import { Button } from "~/components/ui/button";

function Example() {
  return (
    <div>
      <Button variant="default" size="default">デフォルトボタン</Button>
      <Button variant="outline" size="sm">アウトラインボタン</Button>
      <Button variant="destructive">削除ボタン</Button>
    </div>
  );
}
```

#### バリアント

- `default`: プライマリボタン（青背景）
- `destructive`: 破壊的操作用（赤背景）
- `outline`: アウトラインボタン（枠線のみ）
- `secondary`: セカンダリボタン（グレー背景）
- `ghost`: ゴーストボタン（背景なし）
- `link`: リンクスタイル

#### サイズ

- `default`: 標準サイズ（h-9）
- `sm`: 小さいサイズ（h-8）
- `lg`: 大きいサイズ（h-10）
- `icon`: アイコンボタン（size-9）
- `icon-sm`: 小さいアイコンボタン（size-8）
- `icon-lg`: 大きいアイコンボタン（size-10）

---

### Input

テキスト入力フィールドコンポーネント。

#### 場所

`app/components/ui/input.tsx`

#### Props

```typescript
interface InputProps extends React.ComponentProps<"input"> {
  className?: string;
}
```

#### 使用例

```typescript
import { Input } from "~/components/ui/input";

function Example() {
  return (
    <div>
      <Input type="text" placeholder="テキストを入力..." />
      <Input type="email" placeholder="メールアドレス" />
      <Input type="password" placeholder="パスワード" />
    </div>
  );
}
```

#### スタイリング

- フォーカス時のリング表示
- 無効状態のスタイリング
- エラー状態のスタイリング（`aria-invalid`属性で制御）

---

### Avatar

ユーザーアバターを表示するコンポーネント。

#### 場所

`app/components/ui/avatar.tsx`

#### 使用例

```typescript
import { Avatar, AvatarFallback } from "~/components/ui/avatar";

function Example() {
  return (
    <Avatar>
      <AvatarFallback>TA</AvatarFallback>
    </Avatar>
  );
}
```

#### コンポーネント

- `Avatar`: アバターのルートコンポーネント
- `AvatarImage`: 画像を表示（オプション）
- `AvatarFallback`: 画像がない場合のフォールバック

---

### Card

カードコンポーネント。コンテンツをカード形式で表示します。

#### 場所

`app/components/ui/card.tsx`

#### 使用例

```typescript
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from "~/components/ui/card";

function Example() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>カードタイトル</CardTitle>
        <CardDescription>カードの説明</CardDescription>
      </CardHeader>
      <CardContent>
        <p>カードのコンテンツ</p>
      </CardContent>
    </Card>
  );
}
```

#### コンポーネント

- `Card`: カードのルートコンポーネント
- `CardHeader`: ヘッダー部分
- `CardTitle`: タイトル
- `CardDescription`: 説明文
- `CardContent`: コンテンツ部分
- `CardFooter`: フッター部分（オプション）

---

## コンポーネントのベストプラクティス

### 1. Propsの型定義

すべてのコンポーネントでTypeScriptの型定義を使用：

```typescript
interface ComponentProps {
  // 必須プロパティ
  required: string;
  // オプショナルプロパティ
  optional?: number;
}
```

### 2. アクセシビリティ

- ARIA属性を適切に設定
- キーボード操作に対応
- スクリーンリーダーに対応

### 3. パフォーマンス

- 大きなライブラリは動的インポートを使用
- 不要な再レンダリングを避ける
- React.memoを適切に使用

### 4. スタイリング

- Tailwind CSSを使用
- 再利用可能なスタイルを定義
- ダークモードに対応（将来の拡張）

---

## コンポーネントの追加方法

新しいコンポーネントを追加する場合：

1. **適切なディレクトリに配置**
   - 機能別: `app/components/{feature}/`
   - UIコンポーネント: `app/components/ui/`

2. **型定義を追加**
   ```typescript
   interface NewComponentProps {
     // props定義
   }
   ```

3. **ドキュメントを更新**
   - このドキュメントに追加
   - 使用例を含める

4. **テストを追加**
   - `tests/unit/components/`にテストファイルを作成

---

**最終更新**: 2025年12月5日



