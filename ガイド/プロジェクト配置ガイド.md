# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé…ç½®ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€åˆ†å‰²ã—ãŸä»•æ§˜æ›¸ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## æ¨å¥¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
rag-chat-app/
â”œâ”€â”€ docs/                          # ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ README.md                  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ 01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯.md
â”‚   â”œâ”€â”€ 02_ç’°å¢ƒå¤‰æ•°è¨­å®š.md
â”‚   â”œâ”€â”€ 03_APIä»•æ§˜.md
â”‚   â”œâ”€â”€ 04_èªè¨¼è¨­è¨ˆ.md
â”‚   â”œâ”€â”€ 05_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†.md
â”‚   â”œâ”€â”€ 06_ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°.md
â”‚   â”œâ”€â”€ 07_å‹å®šç¾©.md
â”‚   â”œâ”€â”€ 08_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase1.md
â”‚   â”œâ”€â”€ 09_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase2.md
â”‚   â”œâ”€â”€ 10_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase3.md
â”‚   â”œâ”€â”€ 11_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase4.md
â”‚   â””â”€â”€ 12_ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.md
â”‚
â”œâ”€â”€ app/                           # ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ components/                # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â””â”€â”€ ui/                    # shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ lib/                       # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ auth/                  # èªè¨¼é–¢é€£
â”‚   â”‚   â”œâ”€â”€ dify/                  # Dify APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ graph/                 # Graph APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ session/               # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logging/               # ãƒ­ã‚®ãƒ³ã‚°
â”‚   â”‚   â””â”€â”€ utils/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ routes/                    # React Routerãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ _auth.login.tsx
â”‚   â”‚   â”œâ”€â”€ auth.tsx
â”‚   â”‚   â”œâ”€â”€ _auth.logout.tsx
â”‚   â”‚   â”œâ”€â”€ _protected.chat.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ types/                     # TypeScriptå‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”œâ”€â”€ dify.ts
â”‚   â”‚   â”œâ”€â”€ graph.ts
â”‚   â”‚   â””â”€â”€ error.ts
â”‚   â””â”€â”€ root.tsx                   # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚
â”œâ”€â”€ tests/                         # ğŸ§ª ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”œâ”€â”€ auth.spec.ts
â”‚   â”‚   â””â”€â”€ chat.spec.ts
â”‚   â””â”€â”€ mocks/
â”‚
â”œâ”€â”€ public/                        # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ .env.example                   # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .env                           # ç’°å¢ƒå¤‰æ•° (gitignore)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ README.md                      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
â””â”€â”€ Dockerfile
```

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```bash
# React Router v7ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
npx create-react-router@latest rag-chat-app
cd rag-chat-app
```

### 2. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é…ç½®

```bash
# docsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir docs

# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸä»•æ§˜æ›¸ã‚’docsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
# (ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ ~/Downloads ã«ã‚ã‚‹ã¨ä»®å®š)
cp ~/Downloads/README.md docs/
cp ~/Downloads/01_*.md docs/
cp ~/Downloads/02_*.md docs/
cp ~/Downloads/03_*.md docs/
cp ~/Downloads/04_*.md docs/
cp ~/Downloads/05_*.md docs/
cp ~/Downloads/06_*.md docs/
cp ~/Downloads/07_*.md docs/
cp ~/Downloads/08_*.md docs/
cp ~/Downloads/09_*.md docs/
cp ~/Downloads/10_*.md docs/
cp ~/Downloads/11_*.md docs/
cp ~/Downloads/12_*.md docs/
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# .env.exampleã‚’ã‚³ãƒ”ãƒ¼
# docs/02_ç’°å¢ƒå¤‰æ•°è¨­å®š.md ã®å†…å®¹ã‚’å‚è€ƒã«ä½œæˆ
cp docs/.env.example .env

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
# ã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã„ã¦å¿…è¦ãªå€¤ã‚’è¨­å®š
code .env
```

### 4. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# åŸºæœ¬ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
npm install

# è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
npm install @microsoft/microsoft-graph-client @azure/msal-node
npm install winston
npm install zod

# UIé–¢é€£
npm install react-markdown remark-gfm
npm install react-syntax-highlighter @types/react-syntax-highlighter

# é–‹ç™ºãƒ„ãƒ¼ãƒ«
npm install -D vitest @testing-library/react @testing-library/jest-dom
npm install -D playwright @playwright/test
```

### 5. shadcn/uiã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# shadcn/uiåˆæœŸåŒ–
npx shadcn@latest init

# å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ 
npx shadcn@latest add button
npx shadcn@latest add input
npx shadcn@latest add card
npx shadcn@latest add avatar
npx shadcn@latest add scroll-area
npx shadcn@latest add separator
```

---

## Cursor 2.0ã§ã®é–‹ç™ºãƒ•ãƒ­ãƒ¼

### åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Cursorã§é–‹ã**
   ```bash
   cursor .
   ```

2. **æœ€åˆã«å‚ç…§ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - `docs/README.md` - å…¨ä½“åƒã®æŠŠæ¡
   - `docs/01_æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯.md` - æŠ€è¡“é¸å®šã®ç†è§£
   - `docs/02_ç’°å¢ƒå¤‰æ•°è¨­å®š.md` - ç’°å¢ƒè¨­å®š

### Phase 1: èªè¨¼åŸºç›¤å®Ÿè£…æ™‚

**Cursorã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹é †åº:**

1. `docs/08_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase1.md` â† ãƒ¡ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰
2. `docs/04_èªè¨¼è¨­è¨ˆ.md` â† èªè¨¼ã®è©³ç´°
3. `docs/05_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†.md` â† ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
4. `docs/02_ç’°å¢ƒå¤‰æ•°è¨­å®š.md` â† ç’°å¢ƒå¤‰æ•°å‚ç…§

**å®Ÿè£…é †åº:**
```
1. app/lib/utils/env.ts
2. app/lib/auth/entra-client.ts
3. app/lib/graph/user-service.ts
4. app/lib/session/session-manager.ts
5. app/routes/_auth.login.tsx
6. app/routes/auth.tsx
7. app/routes/_auth.logout.tsx
```

### Phase 2: ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½å®Ÿè£…æ™‚

**Cursorã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ :**

1. `docs/09_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase2.md` â† ãƒ¡ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰
2. `docs/03_APIä»•æ§˜.md` â† APIè©³ç´°
3. `docs/07_å‹å®šç¾©.md` â† å‹å®šç¾©
4. `docs/06_ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°.md` â† ã‚¨ãƒ©ãƒ¼å‡¦ç†

**å®Ÿè£…é †åº:**
```
1. app/types/dify.ts
2. app/types/chat.ts
3. app/lib/dify/dify-client.ts
4. app/routes/_protected.chat.tsx
5. app/components/chat/ChatMessage.tsx
```

### Phase 3: UI/UXæ”¹å–„æ™‚

**Cursorã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ :**

1. `docs/10_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase3.md` â† ãƒ¡ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰

**å®Ÿè£…é †åº:**
```
1. shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ 
2. app/components/layout/Header.tsx
3. app/components/layout/Sidebar.tsx
4. app/components/chat/ChatMessage.tsx (Markdownå¯¾å¿œ)
```

### Phase 4: æ©Ÿèƒ½æ‹¡å¼µæ™‚

**Cursorã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ :**

1. `docs/11_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase4.md` â† ãƒ¡ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰
2. `docs/03_APIä»•æ§˜.md` â† å±¥æ­´APIå‚ç…§

---

## .gitignoreã®è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã® `.gitignore` ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```gitignore
# Environment variables
.env
.env.local
.env.*.local

# Logs
logs/
*.log

# Dependencies
node_modules/

# Build outputs
dist/
build/
.cache/

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db

# Testing
coverage/
.playwright/
test-results/
```

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆREADME.mdã®ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã® `README.md` ã¯ç°¡æ½”ã«:

```markdown
# ç¤¾å†…RAGæ¤œç´¢ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

Microsoft Entra IDèªè¨¼ã‚’ä½¿ç”¨ã—ãŸç¤¾å†…å‘ã‘RAGãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ [docs/README.md](./docs/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

\`\`\`bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev
\`\`\`

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- React 19 + React Router v7
- TypeScript 5.x
- Tailwind CSS + shadcn/ui
- Microsoft Entra ID + Graph API
- Dify (RAG Engine)

## é–‹ç™ºã®é€²ã‚æ–¹

[docs/README.md](./docs/README.md) ã®ã€Œé–‹ç™ºã®é€²ã‚æ–¹ã€ã‚’å‚ç…§
```

---

## Cursor Composerã§ã®æ´»ç”¨æ–¹æ³•

### 1. Phaseåˆ¥ã®é–‹ç™º

å„Phaseã‚’é–‹å§‹ã™ã‚‹ã¨ãã«ã€Composer ã«ä»¥ä¸‹ã‚’æŒ‡ç¤º:

```
@docs/08_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase1.md ã‚’å‚ç…§ã—ã¦ã€
Phase 1ã®èªè¨¼åŸºç›¤ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

ã¾ãš app/lib/utils/env.ts ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚
```

### 2. ç‰¹å®šæ©Ÿèƒ½ã®å®Ÿè£…

```
@docs/04_èªè¨¼è¨­è¨ˆ.md ã¨ @docs/05_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†.md ã‚’å‚ç…§ã—ã¦ã€
app/lib/session/session-manager.ts ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
```

### 3. ã‚¨ãƒ©ãƒ¼å¯¾å¿œ

```
@docs/06_ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°.md ã‚’å‚ç…§ã—ã¦ã€
Dify APIæ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å‡¦ç†ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
```

### 4. å‹å®šç¾©ã®å‚ç…§

```
@docs/07_å‹å®šç¾©.md ã‚’å‚ç…§ã—ã¦ã€
ãƒãƒ£ãƒƒãƒˆé–¢é€£ã®å‹ã‚’ app/types/chat.ts ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
```

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q1: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒé•·ã™ãã¦Cursorã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åã¾ã‚‰ãªã„

**A**: å¿…è¦ãªéƒ¨åˆ†ã ã‘ã‚’å‚ç…§ã—ã¦ãã ã•ã„
- Phaseå®Ÿè£…æ™‚: è©²å½“Phaseã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã®ã¿
- ç‰¹å®šæ©Ÿèƒ½å®Ÿè£…æ™‚: ãã®æ©Ÿèƒ½ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿
- ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã§ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ç›´æ¥ä½¿ç”¨

### Q2: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–“ã®ãƒªãƒ³ã‚¯ãŒæ©Ÿèƒ½ã—ãªã„

**A**: Cursorã§ã¯ç›¸å¯¾ãƒ‘ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã‘ã¾ã™
```
# ä¾‹: README.md ã‹ã‚‰ä»–ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é–‹ã
Cmd/Ctrl + P ã§ã€Œ04_èªè¨¼è¨­è¨ˆ.mdã€ã‚’æ¤œç´¢
```

### Q3: å®Ÿè£…é †åºãŒã‚ã‹ã‚‰ãªã„

**A**: ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’å‚ç…§
```
@docs/12_ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.md ã‚’ç¢ºèªã—ã¦ã€
ç¾åœ¨ã®Phaseã§å¿…è¦ãªå®Ÿè£…ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
```

---

## ã¾ã¨ã‚

### âœ… é…ç½®å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `docs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã™ã¹ã¦ã®ä»•æ§˜æ›¸ã‚’é…ç½®
- [ ] `.env.example` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã‚³ãƒ”ãƒ¼
- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ç·¨é›†
- [ ] `README.md` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆ
- [ ] `.gitignore` ã«å¿…è¦ãªé …ç›®ã‚’è¿½åŠ 
- [ ] ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [ ] shadcn/uiã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ğŸ¯ é–‹ç™ºé–‹å§‹ã®æº–å‚™

1. Cursorã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
2. `docs/README.md` ã§å…¨ä½“åƒã‚’ç¢ºèª
3. `docs/08_å®Ÿè£…ã‚¬ã‚¤ãƒ‰_Phase1.md` ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
4. `docs/12_ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.md` ã§é€²æ—ç¢ºèª

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ
