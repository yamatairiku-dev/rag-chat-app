# クイックスタートガイド 🚀

このガイドに従えば、5ステップで開発環境をセットアップできます。

---

## 📦 ダウンロードしたファイル一覧

```
Downloads/
├── README.md                          # メインドキュメント
├── 01_技術スタック.md ~ 12_チェックリスト.md  # 仕様書（12ファイル）
├── プロジェクト配置ガイド.md            # 配置ガイド
├── 環境変数セットアップガイド.md        # 環境変数ガイド
├── setup.sh                           # セットアップスクリプト
├── .env.example                       # 本番環境用テンプレート
└── .env.development.example           # 開発環境用テンプレート
```

---

## ⚡ 5ステップセットアップ

### ステップ1: プロジェクト作成

```bash
# React Router v7プロジェクトを作成
npx create-react-router@latest rag-chat-app

cd rag-chat-app
```

### ステップ2: セットアップスクリプト実行

```bash
# setup.shをプロジェクトルートにコピー
cp ~/Downloads/setup.sh .

# 実行権限を付与して実行
chmod +x setup.sh
./setup.sh
```

**setup.shが実行すること:**
- ✅ ディレクトリ構造の作成 (`app/`, `docs/`, `tests/` など)
- ✅ `.gitignore` の作成
- ✅ `package.json` と `tsconfig.json` の作成

### ステップ3: ドキュメントと環境変数テンプレートをコピー

```bash
# 仕様書をdocsフォルダにコピー
cp ~/Downloads/*.md docs/

# 環境変数テンプレートをプロジェクトルートにコピー
cp ~/Downloads/.env.example .
cp ~/Downloads/.env.development.example .
```

### ステップ4: 環境変数を設定

```bash
# 開発環境用の.envを作成
cp .env.development.example .env

# .envファイルを編集
code .env  # VS Code
# または
vim .env   # Vim
```

**最低限必要な設定:**
```bash
# 1. Azure Portal でEntra IDアプリを登録
# 2. 以下を.envに設定:
ENTRA_CLIENT_ID=<Azure Portalから取得>
ENTRA_CLIENT_SECRET=<Azure Portalで生成>
ENTRA_TENANT_ID=<Azure Portalから取得>

# 3. Dify API設定
DIFY_API_URL=http://localhost:8000  # またはDify VMのURL
DIFY_API_KEY=app-xxxxx...            # Difyから取得

# 4. セッションシークレット生成
# 以下のコマンドで生成:
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# 生成された文字列をSESSION_SECRETに設定
```

**詳細は [環境変数セットアップガイド.md](./環境変数セットアップガイド.md) を参照**

### ステップ5: 依存関係のインストール

```bash
# 依存パッケージをインストール
npm install

# shadcn/ui セットアップ
npx shadcn@latest init

# 必要なUIコンポーネントを追加
npx shadcn@latest add button input card avatar scroll-area separator
```

---

## 🎉 セットアップ完了！

開発サーバーを起動しましょう:

```bash
npm run dev
```

ブラウザで http://localhost:3000 を開く

---

## 📚 次のステップ

### 1. ドキュメントを確認

```bash
# Cursorで開く
cursor .

# まず以下を読む:
# - docs/README.md （全体像）
# - docs/01_技術スタック.md （技術理解）
```

### 2. Azure設定を完了

**[docs/04_認証設計.md](./docs/04_認証設計.md)** を参照して:
- ✅ Entra IDアプリ登録
- ✅ APIパーミッション設定
- ✅ リダイレクトURI設定
- ✅ グループ作成（DEPT_XXX_部署名）

### 3. 実装開始

**[docs/08_実装ガイド_Phase1.md](./docs/08_実装ガイド_Phase1.md)** から開始

---

## 🎯 Cursorでの開発

### Composer への指示例

```
@docs/08_実装ガイド_Phase1.md を参照して、
Phase 1の認証基盤を実装してください。

実装順序:
1. app/lib/utils/env.ts
2. app/lib/auth/entra-client.ts
3. app/lib/graph/user-service.ts
4. app/lib/session/session-manager.ts
5. app/routes/_auth.login.tsx

関連ドキュメント:
@docs/04_認証設計.md
@docs/05_セッション管理.md
```

---

## ✅ セットアップチェックリスト

### プロジェクト構造
- [ ] `rag-chat-app/` フォルダを作成
- [ ] `setup.sh` を実行
- [ ] `docs/` に仕様書をコピー
- [ ] `.env.example` をコピー
- [ ] `.env.development.example` をコピー

### 環境変数
- [ ] `.env` ファイルを作成
- [ ] `ENTRA_CLIENT_ID` を設定
- [ ] `ENTRA_CLIENT_SECRET` を設定
- [ ] `ENTRA_TENANT_ID` を設定
- [ ] `DIFY_API_URL` を設定
- [ ] `DIFY_API_KEY` を設定
- [ ] `SESSION_SECRET` を生成・設定

### Azure設定
- [ ] Entra IDアプリを登録
- [ ] リダイレクトURI設定（`http://localhost:3000/callback`）
- [ ] APIパーミッション（User.Read, GroupMember.Read.All）
- [ ] 管理者の同意を付与
- [ ] グループ作成（`DEPT_001_営業部` など）

### 依存関係
- [ ] `npm install` を実行
- [ ] `shadcn/ui` をセットアップ
- [ ] UIコンポーネントを追加

### 動作確認
- [ ] `npm run dev` でサーバー起動
- [ ] `http://localhost:3000` にアクセス可能
- [ ] 環境変数バリデーションが通る

---

## 🆘 トラブルシューティング

### Q: setup.shの実行でエラーが出る

```bash
# 権限を確認
ls -l setup.sh

# 実行権限がない場合
chmod +x setup.sh

# 再実行
./setup.sh
```

### Q: npm installでエラーが出る

```bash
# キャッシュをクリア
npm cache clean --force

# node_modulesを削除して再インストール
rm -rf node_modules
npm install
```

### Q: 環境変数の検証エラー

```bash
# .envファイルを確認
cat .env

# 必須項目が設定されているか確認
# エラーメッセージに従って修正
```

### Q: Entra ID認証でエラー

**チェック項目:**
1. Azure Portalのリダイレクトuriと.envが一致
2. APIパーミッションが付与されている
3. 管理者の同意が付与されている
4. クライアントシークレットが期限切れでない

---

## 📖 ドキュメント参照先

| 目的 | ドキュメント |
|------|-------------|
| 全体把握 | [docs/README.md](./docs/README.md) |
| 技術理解 | [docs/01_技術スタック.md](./docs/01_技術スタック.md) |
| 環境設定 | [環境変数セットアップガイド.md](./環境変数セットアップガイド.md) |
| Azure設定 | [docs/04_認証設計.md](./docs/04_認証設計.md) |
| 実装開始 | [docs/08_実装ガイド_Phase1.md](./docs/08_実装ガイド_Phase1.md) |
| 進捗確認 | [docs/12_チェックリスト.md](./docs/12_チェックリスト.md) |

---

## 💡 ヒント

### 効率的な開発のコツ

1. **Phase別に進める**
   - 一度に全体を実装しない
   - 各Phase完了後に動作確認

2. **Cursorを活用**
   - `@docs/XX.md` で仕様書を参照
   - Composer に実装を依頼

3. **チェックリストで確認**
   - 実装漏れを防ぐ
   - 定期的に進捗確認

4. **困ったら仕様書を読む**
   - エラー対応: [docs/06_エラーハンドリング.md](./docs/06_エラーハンドリング.md)
   - API仕様: [docs/03_API仕様.md](./docs/03_API仕様.md)
   - 型定義: [docs/07_型定義.md](./docs/07_型定義.md)

---

**Happy Coding! 🎉**

ご不明な点がありましたら、各ドキュメントを参照するか、チェックリストで確認してください。
