# 開発環境動作確認ガイド

**作成日**: 2025年12月5日

---

## ✅ 自動確認完了

以下の確認が完了しました：

1. ✅ **環境変数**: `.env`ファイルが存在し、必須環境変数が設定されています
2. ✅ **ビルド**: 正常に完了しました（120ms）
3. ✅ **テスト**: 326テストすべて成功
4. ✅ **開発サーバー**: 起動中...

---

## 🚀 ブラウザでの動作確認

### ステップ1: ブラウザでアクセス

開発サーバーが起動したら、ブラウザで以下にアクセスしてください：

```
http://localhost:3000
```

### ステップ2: 基本動作確認

#### 2.1 ログインページの確認
- [ ] ログインページが表示される
- [ ] 「ログイン」ボタンが表示される
- [ ] ブラウザのコンソール（F12）にエラーがない

#### 2.2 認証機能の確認
1. **ログイン**
   - 「ログイン」ボタンをクリック
   - Entra IDのログインページにリダイレクトされることを確認
   - ログイン情報を入力してログイン
   - チャットページにリダイレクトされることを確認

2. **ユーザー情報の表示**
   - ヘッダーにユーザー名が表示されることを確認
   - ユーザー情報が正しく表示されることを確認

3. **ログアウト**
   - 「ログアウト」ボタンをクリック
   - ログインページにリダイレクトされることを確認

### ステップ3: チャット機能の確認

#### 3.1 メッセージ送信
- [ ] チャット入力欄が表示される
- [ ] メッセージを入力できる
- [ ] 「送信」ボタンをクリックできる

#### 3.2 ストリーミング応答
- [ ] メッセージ送信後、アシスタントの応答が表示される
- [ ] 応答が段階的に表示される（ストリーミング形式）
- [ ] ストリーミング中のインジケーター（▋）が表示される
- [ ] 応答が完了するとインジケーターが消える

#### 3.3 会話履歴
- [ ] 複数のメッセージを送信できる
- [ ] 会話履歴が正しく保持される
- [ ] ページをリロードしても会話履歴が保持される

#### 3.4 エラーハンドリング
1. **ネットワークエラーのシミュレート**
   - ブラウザの開発者ツール（F12）を開く
   - Networkタブで「Disable cache」を有効化
   - ネットワークを「Offline」に設定
   - メッセージを送信
   - エラーメッセージが表示されることを確認

2. **リトライ機能**
   - エラーが発生したメッセージに「再試行」ボタンが表示されることを確認
   - 「再試行」ボタンをクリック
   - メッセージが再送信されることを確認

### ステップ4: UI/UXの確認

#### 4.1 レスポンシブデザイン
- [ ] ブラウザのウィンドウサイズを変更
- [ ] モバイルサイズ（375px）で表示が適切であることを確認
- [ ] タブレットサイズ（768px）で表示が適切であることを確認
- [ ] デスクトップサイズ（1920px）で表示が適切であることを確認

#### 4.2 アクセシビリティ
- [ ] キーボード操作で全機能が使用できることを確認
- [ ] Tabキーでフォーカスが移動することを確認
- [ ] Enterキーでメッセージを送信できることを確認

### ステップ5: パフォーマンスの確認

#### 5.1 初回ロード時間
1. ブラウザの開発者ツール（F12）を開く
2. Networkタブを開く
3. ページをリロード（Ctrl+R / Cmd+R）
4. 初回ロード時間を確認（目標: 3秒以内）

#### 5.2 APIレスポンスタイム
1. NetworkタブでAPIリクエストを確認
2. `/api/chat-stream`のレスポンスタイムを確認（目標: 2秒以内）

#### 5.3 メモリ使用量
1. Performanceタブを開く
2. 「Record」ボタンをクリック
3. 数回メッセージを送信
4. 「Stop」ボタンをクリック
5. メモリリークがないことを確認

---

## 📊 確認結果の記録

動作確認が完了したら、以下を記録してください：

```markdown
## 動作確認結果

**確認日**: YYYY-MM-DD
**確認者**: [名前]
**環境**: 開発環境

### 基本動作
- [x] ログインページ: ✅
- [x] 認証機能: ✅
- [x] チャット機能: ✅

### パフォーマンス
- 初回ロード時間: [秒]
- APIレスポンスタイム: [秒]

### 問題点
（問題があれば記載）

### 次のアクション
（必要に応じて記載）
```

---

## 🔍 トラブルシューティング

### 問題: サーバーが起動しない

**解決方法**:
```bash
# ポートが使用されているか確認
lsof -i :3000

# 別のポートで起動
PORT=3001 npm run dev
```

### 問題: 認証が動作しない

**確認項目**:
1. `.env`ファイルの`ENTRA_REDIRECT_URI`が`http://localhost:3000/auth`になっているか
2. Azure PortalでリダイレクトURIが登録されているか
3. `ENTRA_CLIENT_ID`と`ENTRA_CLIENT_SECRET`が正しいか

### 問題: Dify API接続エラー

**確認項目**:
1. `.env`ファイルの`DIFY_API_URL`が正しいか
2. `.env`ファイルの`DIFY_API_KEY`が`app-`で始まっているか
3. Dify VMが起動しているか

### 問題: ストリーミングが動作しない

**確認項目**:
1. ブラウザのコンソールでエラーがないか確認
2. Networkタブでストリーミングリクエストが送信されているか確認
3. Dify APIがストリーミングをサポートしているか確認

---

## 📝 関連ドキュメント

- [開発環境動作確認手順](./docs/16_開発環境動作確認手順.md)
- [デプロイ手順書](./docs/15_デプロイ手順書.md)
- [トラブルシューティング](./docs/13_トラブルシューティング.md)

---

**最終更新**: 2025年12月5日

